<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sidebar Expansion/Collapse Demo</title>
    
    <!-- RemixIcon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <!-- Sidebar CSS -->
    <link rel="stylesheet" href="../../public/assets/css/sidebar.css">
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
        }
        
        .demo-container {
            display: flex;
            min-height: 100vh;
        }
        
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 40px;
            transition: margin-left 0.3s ease;
        }
        
        .sidebar.collapsed + .main-content {
            margin-left: 70px;
        }
        
        .demo-card {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .demo-card h2 {
            margin-top: 0;
            color: #1f2937;
        }
        
        .demo-card p {
            color: #6b7280;
            line-height: 1.6;
        }
        
        .test-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .test-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            background: #3b82f6;
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s ease;
        }
        
        .test-btn:hover {
            background: #2563eb;
        }
        
        .test-btn.secondary {
            background: #6b7280;
        }
        
        .test-btn.secondary:hover {
            background: #4b5563;
        }
        
        .status-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .status-indicator.success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-indicator.info {
            background: #dbeafe;
            color: #1e40af;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar" data-user-id="1" data-branch-id="1">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <a href="#">
                        <i class="ri-hospital-line" style="font-size: 32px; color: #3b82f6;"></i>
                        <span class="sidebar-title">HMS</span>
                    </a>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle Sidebar">
                    <i class="ri-menu-fold-line"></i>
                </button>
            </div>
            
            <!-- Branch Info -->
            <div class="sidebar-branch-info">
                <i class="ri-building-line"></i>
                <span class="branch-name">Main Branch</span>
            </div>
            
            <!-- Quick Search -->
            <div class="sidebar-search">
                <div class="search-input-wrapper">
                    <i class="ri-search-line search-icon"></i>
                    <input 
                        type="text" 
                        id="menuSearch" 
                        class="form-control search-input" 
                        placeholder="Search menu..." 
                        autocomplete="off"
                    >
                </div>
            </div>
            
            <!-- Menu Container -->
            <nav class="sidebar-menu" id="sidebarMenu" role="navigation">
                <!-- Will be populated by JavaScript -->
            </nav>
        </aside>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="demo-card">
                <h2>Sidebar Expansion/Collapse Demo <span class="status-indicator success">Task 8.1</span></h2>
                <p>
                    This demo showcases the sidebar menu expansion/collapse functionality implemented for task 8.1.
                    The implementation includes:
                </p>
                <ul>
                    <li><strong>toggleMenuGroup() method</strong> - Expands/collapses menu groups</li>
                    <li><strong>Click event listeners</strong> - Attached to menu groups with children</li>
                    <li><strong>Accordion behavior</strong> - Only one top-level group expanded at a time</li>
                    <li><strong>CSS classes</strong> - "expanded" class for visual state indication</li>
                    <li><strong>State persistence</strong> - Saves expanded state to localStorage</li>
                </ul>
            </div>
            
            <div class="demo-card">
                <h2>Test Controls</h2>
                <p>Use these buttons to test the sidebar functionality:</p>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testExpandFrontOffice()">
                        <i class="ri-arrow-down-s-line"></i> Expand Front Office
                    </button>
                    <button class="test-btn" onclick="testExpandOPD()">
                        <i class="ri-arrow-down-s-line"></i> Expand OPD
                    </button>
                    <button class="test-btn" onclick="testExpandIPD()">
                        <i class="ri-arrow-down-s-line"></i> Expand IPD
                    </button>
                    <button class="test-btn secondary" onclick="testCollapseAll()">
                        <i class="ri-arrow-up-s-line"></i> Collapse All
                    </button>
                    <button class="test-btn secondary" onclick="testToggleSidebar()">
                        <i class="ri-menu-fold-line"></i> Toggle Sidebar
                    </button>
                    <button class="test-btn secondary" onclick="testClearState()">
                        <i class="ri-delete-bin-line"></i> Clear Saved State
                    </button>
                </div>
            </div>
            
            <div class="demo-card">
                <h2>Requirements Validated <span class="status-indicator info">2.2, 2.3, 2.5</span></h2>
                <ul>
                    <li><strong>Requirement 2.2:</strong> Menu groups expand/collapse on click ✓</li>
                    <li><strong>Requirement 2.3:</strong> Expanded groups collapse when clicked again ✓</li>
                    <li><strong>Requirement 2.5:</strong> Only one top-level group expanded at a time (accordion) ✓</li>
                </ul>
            </div>
            
            <div class="demo-card">
                <h2>Console Output</h2>
                <p>Open browser console (F12) to see detailed logs of sidebar operations.</p>
                <pre id="consoleOutput" style="background: #f3f4f6; padding: 16px; border-radius: 6px; overflow-x: auto; font-size: 12px; max-height: 300px; overflow-y: auto;"></pre>
            </div>
        </div>
    </div>
    
    <!-- Mock API responses -->
    <script>
        // Mock fetch for demo purposes
        const originalFetch = window.fetch;
        window.fetch = function(url, options) {
            console.log('[DEMO] Fetch called:', url);
            
            if (url === '/api/v1/menu') {
                return Promise.resolve({
                    ok: true,
                    json: () => Promise.resolve({
                        success: true,
                        data: {
                            menus: [
                                {
                                    menu_key: 'dashboard',
                                    menu_label: 'Dashboard',
                                    menu_icon: 'ri-dashboard-line',
                                    route_path: '/dashboard',
                                    menu_level: 1,
                                    badge_source: null,
                                    children: []
                                },
                                {
                                    menu_key: 'front_office',
                                    menu_label: 'Front Office',
                                    menu_icon: 'ri-service-line',
                                    route_path: null,
                                    menu_level: 1,
                                    badge_source: null,
                                    children: [
                                        {
                                            menu_key: 'registration',
                                            menu_label: 'Registration Desk',
                                            menu_icon: 'ri-user-add-line',
                                            route_path: '/front-office/registration',
                                            menu_level: 2,
                                            badge_source: null,
                                            children: []
                                        },
                                        {
                                            menu_key: 'token_management',
                                            menu_label: 'Token/Queue',
                                            menu_icon: 'ri-list-ordered',
                                            route_path: '/front-office/queue',
                                            menu_level: 2,
                                            badge_source: 'queue_count',
                                            children: []
                                        }
                                    ]
                                },
                                {
                                    menu_key: 'opd',
                                    menu_label: 'OPD',
                                    menu_icon: 'ri-stethoscope-line',
                                    route_path: null,
                                    menu_level: 1,
                                    badge_source: null,
                                    children: [
                                        {
                                            menu_key: 'opd_list',
                                            menu_label: 'Today\'s OPD List',
                                            menu_icon: 'ri-list-check',
                                            route_path: '/opd/list',
                                            menu_level: 2,
                                            badge_source: null,
                                            children: []
                                        },
                                        {
                                            menu_key: 'my_patients',
                                            menu_label: 'My Patients',
                                            menu_icon: 'ri-user-heart-line',
                                            route_path: '/opd/my-patients',
                                            menu_level: 2,
                                            badge_source: 'my_patients',
                                            children: []
                                        }
                                    ]
                                },
                                {
                                    menu_key: 'ipd',
                                    menu_label: 'IPD',
                                    menu_icon: 'ri-hotel-bed-line',
                                    route_path: null,
                                    menu_level: 1,
                                    badge_source: null,
                                    children: [
                                        {
                                            menu_key: 'admissions',
                                            menu_label: 'Admissions',
                                            menu_icon: 'ri-login-box-line',
                                            route_path: '/ipd/admissions',
                                            menu_level: 2,
                                            badge_source: null,
                                            children: []
                                        },
                                        {
                                            menu_key: 'bed_management',
                                            menu_label: 'Bed Management',
                                            menu_icon: 'ri-hotel-bed-line',
                                            route_path: '/ipd/beds',
                                            menu_level: 2,
                                            badge_source: 'available_beds',
                                            children: []
                                        }
                                    ]
                                }
                            ]
                        }
                    })
                });
            }
            
            if (url === '/api/v1/menu/badges') {
                return Promise.resolve({
                    ok: true,
                    json: () => Promise.resolve({
                        success: true,
                        data: {
                            queue_count: 8,
                            my_patients: 12,
                            available_beds: 4
                        }
                    })
                });
            }
            
            return originalFetch(url, options);
        };
    </script>
    
    <!-- Sidebar JavaScript -->
    <script src="../../public/assets/js/sidebar.js"></script>
    
    <!-- Test Functions -->
    <script>
        function testExpandFrontOffice() {
            console.log('[TEST] Expanding Front Office');
            window.sidebarController.toggleMenuGroup('front_office');
        }
        
        function testExpandOPD() {
            console.log('[TEST] Expanding OPD');
            window.sidebarController.toggleMenuGroup('opd');
        }
        
        function testExpandIPD() {
            console.log('[TEST] Expanding IPD');
            window.sidebarController.toggleMenuGroup('ipd');
        }
        
        function testCollapseAll() {
            console.log('[TEST] Collapsing all groups');
            const expandedItems = document.querySelectorAll('.menu-item.expanded');
            expandedItems.forEach(item => {
                const menuKey = item.dataset.menuKey;
                if (menuKey) {
                    window.sidebarController.toggleMenuGroup(menuKey);
                }
            });
        }
        
        function testToggleSidebar() {
            console.log('[TEST] Toggling sidebar collapsed state');
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
        }
        
        function testClearState() {
            console.log('[TEST] Clearing saved state');
            localStorage.removeItem('menu_state_1');
            alert('Saved state cleared. Refresh the page to see the effect.');
        }
        
        // Capture console logs
        const originalLog = console.log;
        const consoleOutput = document.getElementById('consoleOutput');
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            consoleOutput.textContent += message + '\n';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };
    </script>
</body>
</html>
